{"ast":null,"code":"import _objectSpread from\"C:/Sites/Railway/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useCallback}from\"react\";import axios from\"axios\";import\"./styles/queueStyles.css\";// ✅ Ensure this file exists\nimport{calculateETC}from\"./utils/calculateETC\";import{sendWhatsAppNotification}from\"./utils/sendWhatsAppNotification\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const BASE_URL=\"https://newqueue-production.up.railway.app\";// ✅ Updated Railway Base URL\nconst Dashboard=()=>{const[orders,setOrders]=useState([]);const[activeOrdersCount,setActiveOrdersCount]=useState(0);// ✅ Fetch orders with debugging\nconst fetchOrders=useCallback(async()=>{try{console.log(\"🔄 Fetching orders from API...\");const response=await axios.get(\"\".concat(BASE_URL,\"/api/orders\"));// ✅ Updated Railway API URL\nconsole.log(\"✅ Full API Orders Data:\",JSON.stringify(response.data,null,2));const updatedOrders=response.data.map(order=>_objectSpread(_objectSpread({},order),{},{dynamicETC:calculateETC(order.category,activeOrdersCount)||\"N/A\"}));setOrders(updatedOrders);console.log(\"✅ Orders have been set in React state:\",updatedOrders);}catch(error){console.error(\"🚨 Error fetching orders:\",error);}},[activeOrdersCount]);// ✅ Fetch active orders count\nconst fetchActiveOrdersCount=async()=>{try{console.log(\"🔍 Fetching active orders count...\");const response=await axios.get(\"\".concat(BASE_URL,\"/api/active-orders-count\"),{timeout:10000});// ✅ Updated Railway API URL\nsetActiveOrdersCount(response.data.activeOrders);console.log(\"✅ Active orders count:\",response.data.activeOrders);}catch(error){console.error(\"🚨 Error fetching active orders count:\",error.message);}};// ✅ Calls fetching functions when the component loads\nuseEffect(()=>{fetchOrders();fetchActiveOrdersCount();},[fetchOrders]);const updateStatus=async(orderId,newStatus,clientNumber)=>{console.log(\"\\uD83D\\uDEE0 Updating order \".concat(orderId,\" to \").concat(newStatus));try{await axios.put(\"\".concat(BASE_URL,\"/api/orders/\").concat(orderId),{current_status:newStatus});// ✅ Updated Railway API URL\nconsole.log(\"✅ Order updated successfully!\");fetchOrders();if(newStatus===\"Ready\"){sendWhatsAppNotification(clientNumber,orderId,calculateETC(newStatus,activeOrdersCount));}}catch(error){console.error(\"🚨 Error updating order status:\",error);}};console.log(\"🛠 Orders State in React CC:\",orders.map(order=>({id:order.id,transaction_id:order.transaction_id,colour_code:order.colour_code||\"Missing\"})));return/*#__PURE__*/_jsxs(\"div\",{className:\"container mt-4\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-center\",children:\"Paints Queue Dashboard\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Active Orders: \",/*#__PURE__*/_jsx(\"strong\",{children:activeOrdersCount})]}),/*#__PURE__*/_jsxs(\"table\",{className:\"table table-bordered\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"Transaction ID\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Color Code\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Paint Type\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Start Time\"}),/*#__PURE__*/_jsx(\"th\",{children:\"ETC\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Status\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Client Contact\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Action\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:orders.map(order=>/*#__PURE__*/_jsxs(\"tr\",{className:getOrderClass(order.category),children:[/*#__PURE__*/_jsx(\"td\",{children:order.transaction_id}),/*#__PURE__*/_jsx(\"td\",{children:order.colour_code!==undefined?order.colour_code:\"N/A\"}),/*#__PURE__*/_jsx(\"td\",{children:order.paint_type}),/*#__PURE__*/_jsx(\"td\",{children:order.start_time}),/*#__PURE__*/_jsx(\"td\",{children:order.dynamicETC}),/*#__PURE__*/_jsx(\"td\",{children:order.current_status}),/*#__PURE__*/_jsx(\"td\",{children:order.client_contact}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsxs(\"select\",{className:\"form-select\",onChange:e=>updateStatus(order.id,e.target.value,order.client_contact),children:[order.current_status&&![\"Mixing\",\"Ready\"].includes(order.current_status)&&/*#__PURE__*/_jsx(\"option\",{value:order.current_status,children:order.current_status}),/*#__PURE__*/_jsx(\"option\",{value:\"Mixing\",children:\"Mixing\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Ready\",children:\"Ready\"})]})})]},order.id))})]})]});};// ✅ Color coding for priority-based orders\nconst getOrderClass=category=>{if(category===\"New Mix\")return\"urgent\";if(category===\"Reorder Mix\")return\"warning\";if(category===\"Colour Code\")return\"standard\";return\"\";};export default Dashboard;","map":{"version":3,"names":["React","useState","useEffect","useCallback","axios","calculateETC","sendWhatsAppNotification","jsx","_jsx","jsxs","_jsxs","BASE_URL","Dashboard","orders","setOrders","activeOrdersCount","setActiveOrdersCount","fetchOrders","console","log","response","get","concat","JSON","stringify","data","updatedOrders","map","order","_objectSpread","dynamicETC","category","error","fetchActiveOrdersCount","timeout","activeOrders","message","updateStatus","orderId","newStatus","clientNumber","put","current_status","id","transaction_id","colour_code","className","children","getOrderClass","undefined","paint_type","start_time","client_contact","onChange","e","target","value","includes"],"sources":["C:/Sites/Railway/client/src/Dashboard.jsx"],"sourcesContent":["import React, { useState, useEffect, useCallback } from \"react\";\r\nimport axios from \"axios\";\r\nimport \"./styles/queueStyles.css\"; // ✅ Ensure this file exists\r\nimport { calculateETC } from \"./utils/calculateETC\"; \r\nimport { sendWhatsAppNotification } from \"./utils/sendWhatsAppNotification\"; \r\n\r\nconst BASE_URL = \"https://newqueue-production.up.railway.app\"; // ✅ Updated Railway Base URL\r\n\r\nconst Dashboard = () => {\r\n    const [orders, setOrders] = useState([]);\r\n    const [activeOrdersCount, setActiveOrdersCount] = useState(0); \r\n\r\n    // ✅ Fetch orders with debugging\r\n   const fetchOrders = useCallback(async () => {\r\n    try {\r\n        console.log(\"🔄 Fetching orders from API...\");\r\n        const response = await axios.get(`${BASE_URL}/api/orders`); // ✅ Updated Railway API URL\r\n        console.log(\"✅ Full API Orders Data:\", JSON.stringify(response.data, null, 2));\r\n\r\n        const updatedOrders = response.data.map(order => ({\r\n            ...order,\r\n            dynamicETC: calculateETC(order.category, activeOrdersCount) || \"N/A\"\r\n        }));\r\n\r\n        setOrders(updatedOrders);\r\n        console.log(\"✅ Orders have been set in React state:\", updatedOrders);\r\n    } catch (error) {\r\n        console.error(\"🚨 Error fetching orders:\", error);\r\n    }\r\n}, [activeOrdersCount]);\r\n\r\n    // ✅ Fetch active orders count\r\n    const fetchActiveOrdersCount = async () => {\r\n        try {\r\n            console.log(\"🔍 Fetching active orders count...\");\r\n            const response = await axios.get(`${BASE_URL}/api/active-orders-count`, { timeout: 10000 }); // ✅ Updated Railway API URL\r\n            setActiveOrdersCount(response.data.activeOrders);\r\n            console.log(\"✅ Active orders count:\", response.data.activeOrders);\r\n        } catch (error) {\r\n            console.error(\"🚨 Error fetching active orders count:\", error.message);\r\n        }\r\n    };\r\n\r\n    // ✅ Calls fetching functions when the component loads\r\n    useEffect(() => {\r\n        fetchOrders();\r\n        fetchActiveOrdersCount();\r\n    }, [fetchOrders]);\r\n\r\n    const updateStatus = async (orderId, newStatus, clientNumber) => {\r\n        console.log(`🛠 Updating order ${orderId} to ${newStatus}`);\r\n        try {\r\n            await axios.put(`${BASE_URL}/api/orders/${orderId}`, { current_status: newStatus }); // ✅ Updated Railway API URL\r\n            console.log(\"✅ Order updated successfully!\");\r\n            fetchOrders();\r\n\r\n            if (newStatus === \"Ready\") {\r\n                sendWhatsAppNotification(clientNumber, orderId, calculateETC(newStatus, activeOrdersCount));\r\n            }\r\n        } catch (error) {\r\n            console.error(\"🚨 Error updating order status:\", error);\r\n        }\r\n    };\r\n\r\n    console.log(\"🛠 Orders State in React CC:\", orders.map(order => ({\r\n        id: order.id,\r\n        transaction_id: order.transaction_id,\r\n        colour_code: order.colour_code || \"Missing\"\r\n    })));\r\n\r\n    return (\r\n        <div className=\"container mt-4\">\r\n            <h1 className=\"text-center\">Paints Queue Dashboard</h1>\r\n            <p>Active Orders: <strong>{activeOrdersCount}</strong></p> \r\n\r\n            <table className=\"table table-bordered\">\r\n                <thead>\r\n                    <tr>\r\n                        <th>Transaction ID</th>\r\n                        <th>Color Code</th> \r\n                        <th>Paint Type</th>\r\n                        <th>Start Time</th>\r\n                        <th>ETC</th>\r\n                        <th>Status</th>\r\n                        <th>Client Contact</th>\r\n                        <th>Action</th>\r\n                    </tr>\r\n                </thead>\r\n                <tbody>\r\n                    {orders.map(order => (\r\n                        <tr key={order.id} className={getOrderClass(order.category)}> \r\n                            <td>{order.transaction_id}</td>\r\n                            <td>{order.colour_code !== undefined ? order.colour_code : \"N/A\"}</td>\r\n                            <td>{order.paint_type}</td>\r\n                            <td>{order.start_time}</td>\r\n                            <td>{order.dynamicETC}</td> \r\n                            <td>{order.current_status}</td>\r\n                            <td>{order.client_contact}</td>\r\n                            <td>\r\n                                <select\r\n                                    className=\"form-select\"\r\n                                    onChange={(e) => updateStatus(order.id, e.target.value, order.client_contact)}\r\n                                >\r\n                                    {order.current_status && ![\"Mixing\", \"Ready\"].includes(order.current_status) && (\r\n                                        <option value={order.current_status}>{order.current_status}</option> \r\n                                    )}\r\n                                    <option value=\"Mixing\">Mixing</option> \r\n                                    <option value=\"Ready\">Ready</option> \r\n                                </select>\r\n                            </td>\r\n                        </tr>\r\n                    ))}\r\n                </tbody>\r\n            </table>\r\n        </div>\r\n    );\r\n};\r\n\r\n// ✅ Color coding for priority-based orders\r\nconst getOrderClass = (category) => {\r\n    if (category === \"New Mix\") return \"urgent\";  \r\n    if (category === \"Reorder Mix\") return \"warning\"; \r\n    if (category === \"Colour Code\") return \"standard\"; \r\n    return \"\"; \r\n};\r\n\r\nexport default Dashboard;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}